<!DOCTYPE html>
<html>
<head>
    <title>Отладка галереи</title>
    <style>
        .gallery {
            position: relative;
            width: 300px;
            height: 400px;
            background: #f5f5f5;
            overflow: hidden;
            margin: 20px;
        }
        .gallery img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity .18s ease;
            will-change: opacity;
            backface-visibility: hidden;
            z-index: 1;
        }
        .gallery img.is-active {
            opacity: 1;
            z-index: 2;
        }
        .debug-info {
            margin: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Отладка галереи</h1>
    
    <div class="debug-info">
        <h3>Тестовая галерея</h3>
        <p>Наведите курсор на изображение и двигайте мышь влево-вправо</p>
        <p>В консоли должны появляться логи переключения</p>
    </div>
    
    <div class="gallery" id="testGallery">
        <img src="img/product_1/product_1_1.jpg" alt="Фото 1" data-idx="0" class="is-active">
        <img src="img/product_1/product_1_2.jpg" alt="Фото 2" data-idx="1">
        <img src="img/product_1/product_1_3.jpg" alt="Фото 3" data-idx="2">
        <img src="img/product_1/product_1_4.jpg" alt="Фото 4" data-idx="3">
    </div>
    
    <div class="debug-info">
        <h3>Статус</h3>
        <div id="status">Ожидание...</div>
    </div>

    <script>
        console.log('Отладка галереи запущена');
        
        const gallery = document.getElementById('testGallery');
        const imgs = [...gallery.querySelectorAll('img')];
        const statusDiv = document.getElementById('status');
        
        console.log('Найдено изображений:', imgs.length);
        
        let active = imgs.findIndex(i => i.classList.contains('is-active'));
        if (active < 0) { 
            active = 0; 
            imgs[0].classList.add('is-active'); 
        }
        
        console.log('Активное изображение:', active);
        
        let raf = 0;
        const update = (clientX) => {
            const r = gallery.getBoundingClientRect();
            const x = Math.min(Math.max(clientX - r.left, 0), r.width);
            const idx = Math.min(imgs.length - 1, Math.floor(x / r.width * imgs.length));
            
            console.log(`mouseX=${clientX}, rect.left=${r.left}, x=${x}, idx=${idx}, active=${active}`);
            statusDiv.textContent = `Мышь: ${clientX}, X: ${x}, Индекс: ${idx}, Активный: ${active}`;
            
            if (idx === active) return;
            
            cancelAnimationFrame(raf);
            raf = requestAnimationFrame(() => {
                console.log(`Переключаем с ${active} на ${idx}`);
                imgs[active]?.classList.remove('is-active');
                active = idx;
                imgs[active]?.classList.add('is-active');
                statusDiv.textContent = `Переключено на изображение ${idx + 1}`;
            });
        };

        gallery.addEventListener('mousemove', e => update(e.clientX));
        gallery.addEventListener('touchmove', e => update(e.touches[0].clientX), { passive: true });
        
        console.log('Обработчики событий добавлены');
        statusDiv.textContent = 'Готово! Двигайте мышь над изображением';
    </script>
</body>
</html>
